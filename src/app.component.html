<div class="relative w-full h-screen bg-black overflow-hidden font-mono selection:bg-cyan-900 selection:text-white">
  <!-- FULL SCREEN VIEWPORT (Background Layer) -->
  <app-viewport [state]="gameState()" [imageSrc]="currentImage()" [loading]="isLoading()"
    (interact)="handleInteraction($event)" (dialogueChoice)="handleDialogue($event)" class="absolute inset-0 z-0">
  </app-viewport>

  <!-- UI OVERLAYS (Top Layer) -->
  <div class="absolute inset-0 z-10 pointer-events-none flex flex-col">

    <!-- Header Overlay -->
    <header
      class="h-24 bg-gradient-to-b from-black/80 to-transparent flex items-start justify-between p-4 pointer-events-auto">
      <div class="flex items-start space-x-3">
        <img src="/logo.png" alt="Vesper Project Apep" class="h-10 object-contain">
      </div>

      <div class="flex items-center space-x-4">
        <!-- Save/Load Controls -->
        <div class="flex space-x-2">
          <button (click)="saveGame()" class="p-2 bg-slate-800/20 hover:bg-slate-950/80 rounded transition-all">
            <img src="/save.png" alt="Save" class="w-8 h-8 object-contain opacity-80">
          </button>
          <button (click)="loadGame()" class="p-2 bg-slate-800/20 hover:bg-slate-950/80 rounded transition-all">
            <img src="/load.png" alt="Load" class="w-8 h-8 object-contain opacity-80 transform rotate-180">
          </button>
          <button (click)="toggleSidebar()" class="p-2 bg-slate-800/20 hover:bg-slate-950/80 rounded transition-all"
            [class.bg-cyan-900]="isSidebarOpen()">
            <img src="/terminal.png" alt="Data" class="w-8 h-8 object-contain opacity-80">
          </button>
        </div>
      </div>
    </header>

    <!-- Middle Area (for Sidebar overlay) -->
    <div class="flex-1 flex justify-end relative overflow-hidden">
      <!-- Sidebar as Overlay -->
      <aside
        class="w-80 h-full bg-slate-950/90 backdrop-blur-md border-l border-slate-800 pointer-events-auto transition-transform duration-500"
        [style.transform]="isSidebarOpen() ? 'translateX(0)' : 'translateX(100%)'">

        <div class="flex-1 flex flex-col items-center justify-center p-6 text-slate-500">
          <div
            class="w-12 h-12 border border-slate-800 rounded-full flex items-center justify-center mb-4 animate-pulse">
            <span class="text-xs">AI</span>
          </div>
          <p class="text-[10px] tracking-widest uppercase opacity-50">Data Link Active</p>

          <!-- Debug Console inside Sidebar -->
          <div class="mt-auto w-full p-2 bg-black/40 border-t border-slate-800">
            <input type="text" [(ngModel)]="customInput" (keydown.enter)="submitCustomCommand()"
              placeholder="COMMAND..."
              class="w-full bg-transparent border-none outline-none text-cyan-500 font-mono text-[10px]">
          </div>
        </div>
      </aside>
    </div>

    <!-- Bottom Overlays (Action Bar handled by its own component) -->
    <div class="h-28 pointer-events-none"></div>
  </div>

  <!-- Action Bar (Floating Overlay) -->
  <app-action-bar (actionSelected)="onActionSelected($event)" (inventoryToggled)="onInventoryToggled()"
    class="z-50 pointer-events-none">
  </app-action-bar>

  <!-- Inventory Panel (overlay) -->
  <app-inventory-panel [isOpen]="(inventoryService.isOpen$ | async) || false"
    [items]="(inventoryService.items$ | async) || []" (closed)="inventoryService.closeInventory()" class="z-[60]">
  </app-inventory-panel>

</div>